(()=>{"use strict";var t,e,s={},a={};function i(t){var e=a[t];if(void 0!==e)return e.exports;var r=a[t]={exports:{}};return s[t](r,r.exports,i),r.exports}i.m=s,i.d=(t,e)=>{for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},i.f={},i.e=t=>Promise.all(Object.keys(i.f).reduce(((e,s)=>(i.f[s](t,e),e)),[])),i.u=t=>t+".main.js",i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),t={},e="bomberman.js:",i.l=(s,a,r,n)=>{if(t[s])t[s].push(a);else{var o,h;if(void 0!==r)for(var c=document.getElementsByTagName("script"),l=0;l<c.length;l++){var d=c[l];if(d.getAttribute("src")==s||d.getAttribute("data-webpack")==e+r){o=d;break}}o||(h=!0,(o=document.createElement("script")).charset="utf-8",o.timeout=120,i.nc&&o.setAttribute("nonce",i.nc),o.setAttribute("data-webpack",e+r),o.src=s),t[s]=[a];var m=(e,a)=>{o.onerror=o.onload=null,clearTimeout(u);var i=t[s];if(delete t[s],o.parentNode&&o.parentNode.removeChild(o),i&&i.forEach((t=>t(a))),e)return e(a)},u=setTimeout(m.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=m.bind(null,o.onerror),o.onload=m.bind(null,o.onload),h&&document.head.appendChild(o)}},i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t;i.g.importScripts&&(t=i.g.location+"");var e=i.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var s=e.getElementsByTagName("script");if(s.length)for(var a=s.length-1;a>-1&&!t;)t=s[a--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),i.p=t})(),(()=>{var t={179:0};i.f.j=(e,s)=>{var a=i.o(t,e)?t[e]:void 0;if(0!==a)if(a)s.push(a[2]);else{var r=new Promise(((s,i)=>a=t[e]=[s,i]));s.push(a[2]=r);var n=i.p+i.u(e),o=new Error;i.l(n,(s=>{if(i.o(t,e)&&(0!==(a=t[e])&&(t[e]=void 0),a)){var r=s&&("load"===s.type?"missing":s.type),n=s&&s.target&&s.target.src;o.message="Loading chunk "+e+" failed.\n("+r+": "+n+")",o.name="ChunkLoadError",o.type=r,o.request=n,a[1](o)}}),"chunk-"+e,e)}};var e=(e,s)=>{var a,r,[n,o,h]=s,c=0;if(n.some((e=>0!==t[e]))){for(a in o)i.o(o,a)&&(i.m[a]=o[a]);h&&h(i)}for(e&&e(s);c<n.length;c++)r=n[c],i.o(t,r)&&t[r]&&t[r][0](),t[r]=0},s=self.webpackChunkbomberman_js=self.webpackChunkbomberman_js||[];s.forEach(e.bind(null,0)),s.push=e.bind(null,s.push.bind(s))})();const r=i.p+"assets/images/title_bombers.png",n=i.p+"assets/images/chemin.png",o=i.p+"assets/images/arena_wall.png",h=i.p+"assets/images/arena_bomber_walk.png",c=i.p+"assets/images/arena_bomber_death.png",l=i.p+"assets/images/arena_bomb.png",d=i.p+"assets/images/arena_flame.png",m=i.p+"assets/images/arena_item.png",u=i.p+"assets/images/winner_bomber.png";class p{static titleWallpaper(){return this.titleImage||(this.titleImage=new Image,this.titleImage.src=r),this.titleImage}static ground(){return this.groundImage||(this.groundImage=new Image,this.groundImage.src=n),this.groundImage}static wall(){return this.wallImage||(this.wallImage=new Image,this.wallImage.src=o,this.wallImage.width=32,this.wallImage.height=32),this.wallImage}static characterAlive(){return this.characterAliveImage||(this.characterAliveImage=new Image,this.characterAliveImage.src=h,this.characterAliveImage.width=43,this.characterAliveImage.height=45),this.characterAliveImage}static characterDead(){return this.characterDeadImage||(this.characterDeadImage=new Image,this.characterDeadImage.src=c,this.characterDeadImage.width=517/12,this.characterDeadImage.height=316/7),this.characterDeadImage}static bomb(){return this.bombImage||(this.bombImage=new Image,this.bombImage.src=l,this.bombImage.width=100/3,this.bombImage.height=34),this.bombImage}static flame(){return this.flameImage||(this.flameImage=new Image,this.flameImage.src=d,this.flameImage.width=925/28,this.flameImage.height=34),this.flameImage}static bonus(){return this.itemImage||(this.itemImage=new Image,this.itemImage.src=m,this.itemImage.width=529/16,this.itemImage.height=34),this.itemImage}static characterVictory(){return this.imageVictory||(this.imageVictory=new Image,this.imageVictory.width=25.25,this.imageVictory.height=33.2,this.imageVictory.src=u),this.imageVictory}}const y={UP:"UP",DOWN:"DOWN",LEFT:"LEFT",RIGHT:"RIGHT",ENTER:"ENTER",ADD_PLAYER:"ADD_PLAYER",MENU_OVERFLOW:"MENU_OVERFLOW",ESCAPE:"ESCAPE",RESET:"RESET",ADD_BLAST:"ADD_BLAST",BLAST_VANISHED:"BLAST_VANISHED",DROP_BOMB:"DROP_BOMB",BOMB_EXPLODED:"BOMB_EXPLODED",DESTROY:"DESTROY",KILL:"KILL",VICTORY:"VICTORY",INIT_GAME:"INIT_GAME",CONSUME_BONUS:"CONSUME_BONUS",GET_BONUS:"GET_BONUS",MOVE:"MOVE",BONUS_EXPLODED:"BONUS_EXPLODED"};Object.freeze(y);const g={WHITE:0,BLACK:1,RED:2,BLUE:3,GREEN:4};Object.freeze(g);const x={INITIALISATION:"INITIALISATION",READY:"READY",IN_PROGRESS:"IN_PROGRESS",END:"END"};class f{static menuNext(){return i.e(201).then(i.bind(i,201)).then((t=>{const e=t.default,s=new Audio(e);return s.load(),s}))}static menuPrevious(){return i.e(88).then(i.bind(i,88)).then((t=>{const e=t.default,s=new Audio(e);return s.load(),s}))}static menuBeep(){return i.e(205).then(i.bind(i,205)).then((t=>{const e=t.default,s=new Audio(e);return s.load(),s}))}static bombDrop(){return i.e(0).then(i.bind(i,0)).then((t=>{const e=t.default,s=new Audio(e);return s.load(),s}))}static death(){return i.e(641).then(i.bind(i,641)).then((t=>{const e=t.default,s=new Audio(e);return s.load(),s}))}static explosion(){return i.e(400).then(i.bind(i,400)).then((t=>{const e=t.default,s=new Audio(e);return s.load(),s}))}static bonus(){return i.e(319).then(i.bind(i,319)).then((t=>{const e=t.default,s=new Audio(e);return s.load(),s}))}static win(){return i.e(236).then(i.bind(i,236)).then((t=>{const e=t.default,s=new Audio(e);return s.load(),s}))}}const b={DOWN:1,LEFT:7,RIGHT:4,TOP:10};Object.freeze(b);const E={ALIVE:"ALIVE",VICTORY:"VICTORY",DEAD:"DEAD"};Object.freeze(E);class w{constructor(t,e,s,a,i){this.x=e,this.y=s,this.direction=a,this.animationState=-1,this.color=t,this.radius=2,this.status=E.ALIVE,this.offsetX=0,this.offsetY=0,this.animationDuration=15,this.bombMax=1,this.bombUsed=0,this.pixelsToTreat=0,this.gamePadIndex=i,this.nextFrame=this.getNextFrame(a),B((()=>{this.bonus=R().bonus}))}render(t){switch(this.status){case E.ALIVE:this.renderAlive(t);break;case E.DEAD:this.renderDead(t);break;case E.VICTORY:this.renderVictory(t)}}renderAlive(t){let e,s,a=1;this.animationState>=this.animationDuration?this.animationState=-1:this.animationState>=0&&(a=Math.floor(this.animationState/8),a>3&&(a%=4),this.pixelsToTreat=32-this.animationState/this.animationDuration*32,this.pixelsToTreat<16&&(this.x=this.nextFrame.x,this.y=this.nextFrame.y),this.direction===b.TOP?this.offsetY=this.pixelsToTreat:this.direction===b.DOWN?this.offsetY=-this.pixelsToTreat:this.direction===b.LEFT?this.offsetX=this.pixelsToTreat:this.direction===b.RIGHT&&(this.offsetX=-this.pixelsToTreat),this.animationState++),-1!==this.animationState?(e=32*this.nextFrame.x+this.offsetX,s=32*this.nextFrame.y-8+this.offsetY):(e=32*this.x+this.offsetX,s=32*this.y-8+this.offsetY),t.ctx.drawImage(p.characterAlive(),p.characterAlive().width*((()=>{switch(a){case 0:return 1;case 1:case 3:return 0;case 2:return-1}return 1})()+this.direction),p.characterAlive().height*this.color,p.characterAlive().width,p.characterAlive().height,e,s,32,32)}getNextFrame(t){const e={x:this.x,y:this.y};switch(t){case b.DOWN:e.y++;break;case b.LEFT:e.x--;break;case b.RIGHT:e.x++;break;case b.TOP:e.y--}return e}move(t,e){if(!(this.animationState>=0)&&t&&(this.direction=t,this.nextFrame=this.getNextFrame(t),!(this.nextFrame.x<0||this.nextFrame.y<0||this.nextFrame.x>=e.map[0].length||this.nextFrame.y>=e.map.length)&&2===e.map[this.nextFrame.y][this.nextFrame.x]&&(!e.walls[this.nextFrame.x][this.nextFrame.y]||e.walls[this.nextFrame.x][this.nextFrame.y].destroyed))){this.bonus.forEach((t=>{t.x===this.nextFrame.x&&t.y===this.nextFrame.y&&_({type:y.GET_BONUS,payload:{bonus:t,playerColor:this.color}})}));for(let t=0;t<e.bombs.length;t++){const s=e.bombs[t];if(s.x===this.nextFrame.x&&s.y===this.nextFrame.y)return}this.animationState=1}}renderDead(t){this.status===E.ALIVE&&(this.status=E.DEAD,this.animationState=0),t.ctx.drawImage(p.characterDead(),p.characterDead().width*Math.floor(this.animationState/10),p.characterDead().height*this.color,p.characterDead().width,p.characterDead().height,32*this.x,32*this.y,32,32),this.animationState++}renderVictory(t){let e=1;e=Math.floor(this.animationState/this.animationDuration)%2==0?0:1,t.ctx.drawImage(p.characterVictory(),p.characterVictory().width*e,p.characterVictory().height*this.color,p.characterVictory().width,p.characterVictory().height,32*this.x,32*this.y,32,32),this.animationState++}}class T{constructor(t,e,s,a){this.x=t,this.y=e,this.power=s,this.cardinal=a}render(t){t.ctx.drawImage(p.flame(),p.flame().width*this.cardinal-this.power*p.flame().width,0,p.flame().width,p.flame().height,32*this.x,32*this.y,34,34)}}const I={MIDDLE:27,NORTH_MIDDLE:3,EAST_MIDDLE:7,SOUTH_MIDDLE:3,WEST_MIDDLE:7,NORTH_END:11,EAST_END:23,SOUTH_END:19,WEST_END:15};Object.freeze(I);class O{constructor(t,e,s,a,i,r,n){this.walls=a,this.map=s,this.x=t.x,this.y=t.y,this.animationState=0,this.time=0,this.radius=e.radius,this.timer=20,this.flames=[],this.bombs=i,this.characters=r,this.character=e,this.canPropagate={north:!0,east:!0,south:!0,west:!0},this.bonus=n}render(t){let{radius:e}=this;this.animationState++,this.time++>this.timer&&_({type:y.BLAST_VANISHED,payload:{payload:{blast:this}}});const s=this.computePower();this.animationState<=this.radius&&(e=this.animationState),this.flames.push(new T(this.x,this.y,s,I.MIDDLE)),this.computeNorth(e,s,this.canPropagate.north),this.computeEast(e,s,this.canPropagate.east),this.computeSouth(e,s,this.canPropagate.south),this.computeWest(e,s,this.canPropagate.west),this.flames.forEach((e=>{e.render(t),this.bombs.forEach((t=>{t.x===e.x&&t.y===e.y&&(_({type:y.ADD_BLAST,payload:{bomb:t,character:t.character}}),_({type:y.BOMB_EXPLODED,payload:{bomb:t}}))})),this.bonus.forEach((t=>{t.x===e.x&&t.y===e.y&&_({type:y.BONUS_EXPLODED,payload:{item:t}})})),this.characters.forEach((t=>{t.x===e.x&&t.y===e.y&&t.status===E.ALIVE&&_({type:y.KILL,payload:{character:t}})}))}))}computeNorth(t,e){let s=1;for(;s<this.radius;){const t=2===this.map[this.y-s][this.x]&&this.canPropagate.north,a=this.walls[this.x][this.y-s]&&!this.walls[this.x][this.y-s].destroyed;if(!t)break;a&&t?(this.canPropagate.north=!1,this.flames.push(new T(this.x,this.y-s,e,I.NORTH_END)),_({type:y.DESTROY,payload:{destroyedX:this.x,destroyedY:this.y-1}})):!a&&t&&(s+1===this.radius?this.flames.push(new T(this.x,this.y-s,e,I.NORTH_END)):this.flames.push(new T(this.x,this.y-s,e,I.NORTH_MIDDLE))),s++}}computeEast(t,e){let s=1;for(;s<this.radius;){const t=2===this.map[this.y][this.x+s]&&this.canPropagate.east,a=this.walls[this.x+s][this.y]&&!this.walls[this.x+s][this.y].destroyed;if(!t)break;t&&a?(this.canPropagate.east=!1,this.flames.push(new T(this.x+s,this.y,e,I.EAST_END)),_({type:y.DESTROY,payload:{destroyedX:this.x+s,destroyedY:this.y}})):t&&!a&&(s+1===this.radius?this.flames.push(new T(this.x+s,this.y,e,I.EAST_END)):this.flames.push(new T(this.x+s,this.y,e,I.EAST_MIDDLE))),s++}}computeSouth(t,e){let s=1;for(;s<this.radius;){const t=2===this.map[this.y+s][this.x]&&this.canPropagate.south,a=this.walls[this.x][this.y+s]&&!this.walls[this.x][this.y+s].destroyed;if(!t)break;t&&a?(this.canPropagate.south=!1,this.flames.push(new T(this.x,this.y+s,e,I.SOUTH_END)),_({type:y.DESTROY,payload:{destroyedX:this.x,destroyedY:this.y+s}})):t&&!a&&(s+1===this.radius?this.flames.push(new T(this.x,this.y+s,e,I.SOUTH_END)):this.flames.push(new T(this.x,this.y+s,e,I.SOUTH_MIDDLE))),s++}}computeWest(t,e){let s=1;for(;s<this.radius;){const t=2===this.map[this.y][this.x-s]&&this.canPropagate.west,a=this.walls[this.x-s][this.y]&&!this.walls[this.x-s][this.y].destroyed;if(!t)break;t&&a?(this.canPropagate.west=!1,this.flames.push(new T(this.x-s,this.y,e,I.WEST_END)),_({type:y.DESTROY,payload:{destroyedX:this.x-s,destroyedY:this.y}})):t&&!a&&(s+1===this.radius?this.flames.push(new T(this.x-s,this.y,e,I.WEST_END)):this.flames.push(new T(this.x-s,this.y,e,I.WEST_MIDDLE))),s++}}computePower(){let t;switch(this.radius){case 1:case 2:default:t=0;break;case 3:case 4:t=1;break;case 5:case 6:t=2}return t}}class S{constructor(t){this.character=t,this.x=t.x,this.y=t.y,this.animationState=0,this.animationDuration=16,this.timeElapsed=0,this.time=0,this.accelerator=30,this.timer=128}render(t){this.time++;let e=Math.floor(this.animationState/this.animationDuration);if(e>2&&(e%=3),this.animationState++,this.timeElapsed++>this.accelerator){if(this.animationDuration<4){const t=this,{character:e}=this;_({type:y.ADD_BLAST,payload:{bomb:t,character:e}}),_({type:y.BOMB_EXPLODED,payload:{bomb:t}})}this.animationDuration/=2,this.timeElapsed=0}t.ctx.drawImage(p.bomb(),e*p.bomb().width,0,p.bomb().width,p.bomb().height,32*this.x+4,32*this.y+6,32/1.5,32/1.5)}}const D={BOMB:0,POWER:1,SPEED:3};Object.freeze(D);const A={gameStatus:x.INITIALISATION,selectedOption:1,currentScreenCode:"TITLE",map:[[12,14,14,14,14,14,14,14,14,14,14,14,14,14,16],[11,2,2,2,2,2,2,2,2,2,2,2,2,2,9],[11,2,10,2,10,2,10,2,10,2,10,2,10,2,9],[11,2,2,2,2,2,2,2,2,2,2,2,2,2,9],[11,2,10,2,10,2,10,2,10,2,10,2,10,2,9],[11,2,2,2,2,2,2,2,2,2,2,2,2,2,9],[11,2,10,2,10,2,10,2,10,2,10,2,10,2,9],[11,2,2,2,2,2,2,2,2,2,2,2,2,2,9],[11,2,10,2,10,2,10,2,10,2,10,2,10,2,9],[11,2,2,2,2,2,2,2,2,2,2,2,2,2,9],[11,2,10,2,10,2,10,2,10,2,10,2,10,2,9],[11,2,2,2,2,2,2,2,2,2,2,2,2,2,9],[8,6,6,6,6,6,6,6,6,6,6,6,6,6,4]],characters:[],bonus:[],bombs:[],walls:[],blasts:[]},N=[];let L;const R=()=>L,_=t=>{L=function(t,e=A){switch(t.type){case y.UP:return f.menuBeep().then((t=>t.play())),{...e,selectedOption:e.selectedOption-1};case y.DOWN:return f.menuBeep().then((t=>t.play())),{...e,selectedOption:e.selectedOption+1};case y.LEFT:case y.RIGHT:return f.menuBeep().then((t=>t.play())),e;case y.ENTER:const s=P.getNewScreen(e.selectedOption,e.currentScreenCode,e.gameStatus);return"TITLE"===s&&[x.INITIALISATION,x.READY].includes(e.gameStatus)?f.menuPrevious().then((t=>t.play())):f.menuNext().then((t=>t.play())),{...e,selectedOption:1,currentScreenCode:s};case y.ADD_PLAYER:const{characters:a}=e;let{gameStatus:i}=e;if([x.INITIALISATION,x.READY].includes(i)){if(!a.find((e=>e.color===t.payload.index)))switch(t.payload.index){case g.WHITE:a.push(new w(g.WHITE,1,1,b.DOWN));break;case g.BLACK:a.push(new w(g.BLACK,1,11,b.DOWN));break;case g.BLUE:a.push(new w(g.BLUE,13,1,b.DOWN));break;case g.RED:a.push(new w(g.RED,13,11,b.DOWN))}a.length>=2&&(i=x.READY)}return{...e,characters:a,gameStatus:i};case y.MENU_OVERFLOW:return{...e,selectedOption:t.payload.selectedOption};case y.RESET:return setTimeout((()=>{location.reload()}),100),this.state;case y.ADD_BLAST:return e.blasts.push(new O(t.payload.bomb,t.payload.character,e.map,e.walls,e.bombs,e.characters,e.bonus)),{...e};case y.BLAST_VANISHED:return e.blasts.splice(e.blasts.indexOf(t.payload.blast),1),{...e};case y.DROP_BOMB:if(e.gameStatus===x.IN_PROGRESS){const{bombUsed:s}=e.characters.find((e=>e.color===t.payload.color)),{bombMax:a}=e.characters.find((e=>e.color===t.payload.color));if(s<a){e.characters.find((e=>e.color===t.payload.color)).bombUsed++;const s=new S(e.characters.find((e=>e.color===t.payload.color)));e.bombs.push(s),f.bombDrop().then((t=>t.play()))}}return{...e};case y.BOMB_EXPLODED:return e.characters.find((e=>e.color===t.payload.bomb.character.color)).bombUsed--,e.bombs.splice(e.bombs.indexOf(t.payload.bomb),1),f.explosion().then((t=>t.play())),{...e};case y.DESTROY:return e.walls[t.payload.destroyedX][t.payload.destroyedY].destroyed=!0,{...e};case y.KILL:return e.characters.find((e=>e.color===t.payload.character.color)).status=E.DEAD,f.death().then((t=>t.play())),{...e};case y.VICTORY:return e.characters.find((e=>e.color===t.payload.character.color)).status=E.VICTORY,f.win().then((t=>t.play())),{...e,gameStatus:x.END};case y.INIT_GAME:return{...e,gameStatus:x.IN_PROGRESS,currentScreenCode:t.payload.currentScreenCode,walls:t.payload.walls,bonus:t.payload.bonus};case y.GET_BONUS:switch(t.payload.bonus.type){case D.POWER:e.characters.find((e=>e.color===t.payload.playerColor)).radius++;break;case D.BOMB:e.characters.find((e=>e.color===t.payload.playerColor)).bombMax++;break;case D.SPEED:const s=e.characters.find((e=>e.color===t.payload.playerColor));e.characters.find((e=>e.color===t.payload.playerColor))>8&&(e.characters.find((e=>e.color===t.payload.playerColor)).animationDuration=s.animationDuration-1)}const r=e.bonus.find((e=>e.x===t.payload.bonus.x&&e.y===t.payload.bonus.y));return e.bonus.splice(e.bonus.indexOf(r),1),f.bonus().then((t=>t.play())),{...e};case y.MOVE:return e.gameStatus===x.IN_PROGRESS&&e.characters.find((e=>e.color===t.payload.color)).move(t.payload.direction,e),{...e};case y.BONUS_EXPLODED:{const s=e.bonus.find((e=>e.x===t.payload.item.x&&e.y===t.payload.item.y));return e.bonus.splice(e.bonus.indexOf(s),1),{...e}}}}(t,L),N.forEach((t=>t()))},B=t=>(N.push(t),()=>N.filter((e=>e!==t)));class P{constructor(){this.imageTitlePosition=800,this.fontSize=30,this.selectedOption=1,this.playersDilayed=[],B((()=>{this.playersDilayed=R().characters}))}update(t){this.render(t)}render(t){if(t.ctx.fillStyle="rgb(52,173,98)",t.ctx.fillRect(0,400,t.screenWidth,t.screenHeight),t.ctx.fillStyle="lightblue",t.ctx.fillRect(0,0,t.screenWidth,400),this.playersDilayed&&0===this.playersDilayed.length)t.ctx.font="20px Bomberman",t.ctx.textAlign="center",t.ctx.textBaseline="top",t.ctx.fillStyle="yellow",t.ctx.fillText("connect at least 2 controllers",t.screenWidth/2+5+1,21),t.ctx.fillStyle="red",t.ctx.fillText("connect at least 2 controllers",t.screenWidth/2+5,20),t.ctx.fillStyle="yellow",t.ctx.fillText("To start the game",t.screenWidth/2+5+1,41),t.ctx.fillStyle="red",t.ctx.fillText("To start the game",t.screenWidth/2+5,40);else if(this.playersDilayed&&1===this.playersDilayed.length)t.ctx.font="20px Bomberman",t.ctx.textAlign="center",t.ctx.textBaseline="top",t.ctx.fillStyle="yellow",t.ctx.fillText("Connect at least 1 more controller",t.screenWidth/2+5+1,21),t.ctx.fillStyle="red",t.ctx.fillText("Connect at least 1 more controller",t.screenWidth/2+5,20),t.ctx.fillStyle="yellow",t.ctx.fillText("To start the game",t.screenWidth/2+5+1,41),t.ctx.fillStyle="red",t.ctx.fillText("To start the game",t.screenWidth/2+5,40);else{let e=100;t.ctx.font="25px Bomberman",t.ctx.textAlign="center",t.ctx.textBaseline="top",t.ctx.fillStyle="red",this.playersDilayed.forEach(((s,a)=>{a===g.WHITE&&(t.ctx.fillStyle="white"),a===g.BLACK&&(t.ctx.fillStyle="black"),a===g.RED&&(t.ctx.fillStyle="red"),a===g.BLUE&&(t.ctx.fillStyle="blue"),t.ctx.fillText(`Player ${a+1}`,100+e,20),e+=200}))}this.imageTitlePosition>170&&(this.imageTitlePosition-=15),t.ctx.drawImage(p.titleWallpaper(),0,this.imageTitlePosition+5,t.screenWidth,t.screenHeight-160),this.fontSize<90&&this.fontSize++,t.ctx.font=`${this.fontSize}px Bomberman`,t.ctx.textAlign="center",t.ctx.textBaseline="top",t.ctx.fillStyle="gray",t.ctx.fillText("Bomberman.js",t.screenWidth/2+5,85),t.ctx.fillStyle="rgb(250, 250, 250)",t.ctx.fillText("Bomberman.js",t.screenWidth/2,80),t.ctx.font="20px Bomberman",t.ctx.fillStyle="rgb(250, 250, 250)",t.ctx.textAlign="center",t.ctx.textBaseline="middle",t.ctx.fillText("Credit : Lingelo",t.screenWidth/2,this.imageTitlePosition+440)}manageOverflowMenu(t,e,s){this.selectedOption=s,s>e&&(this.selectedOption=e,_({type:y.MENU_OVERFLOW,payload:{selectedOption:this.selectedOption}})),s<t&&(this.selectedOption=t,_({type:y.MENU_OVERFLOW,payload:{selectedOption:this.selectedOption}}))}static getNewScreen(t,e,s){if("TITLE"===e){if(1===t&&s===x.READY)return"NEW_GAME";if(2===t)return"OPTIONS"}if("OPTIONS"===e)return"TITLE"}}class k extends P{constructor(){super(),this.code="TITLE",this.ready=!1,B((()=>{this.manageOverflowMenu(1,2,R().selectedOption),this.ready=R().gameStatus===x.READY}))}render(t){super.render(t),t.ctx.font="60px Bomberman",t.ctx.fillStyle=this.getColorMenu("New Game"),t.ctx.fillText("New Game",t.screenWidth/2,330),t.ctx.fillStyle=this.getColorMenu("Options"),t.ctx.fillText("Options",t.screenWidth/2,420)}getColorMenu(t){return"New Game"===t&&1===this.selectedOption&&this.ready?"yellow":"New Game"!==t||1!==this.selectedOption||this.ready?"Options"===t&&2===this.selectedOption?"yellow":"rgb(250, 250, 250)":"rgb(169,169,169)"}}class v extends P{constructor(){super(),this.code="OPTIONS",B((()=>{this.manageOverflowMenu(1,2,R().selectedOption)}))}render(t){super.render(t),t.ctx.font="50px Bomberman",t.ctx.fillStyle=this.getColorMenu("Sound"),t.ctx.fillText(" Sound : yes",t.screenWidth/2,330),t.ctx.fillStyle=this.getColorMenu("Retour"),t.ctx.fillText("Retour",t.screenWidth/2,420)}getColorMenu(t){return"Sound"===t&&1===this.selectedOption||"Retour"===t&&2===this.selectedOption?"yellow":"rgb(250, 250, 250)"}}class M{constructor(t){this.canvasContext=t}render(t,e){this.canvasContext.ctx.drawImage(p.ground(),0,0,32,32,32*e,32*t,32,32)}}class C{constructor(t,e){this.type=t,this.canvasContext=e}render(t,e){switch(this.type){case"UP_LEFT":this.canvasContext.ctx.drawImage(p.ground(),96,64,32,32,32*e,32*t,32,32);break;case"UP_RIGHT":this.canvasContext.ctx.drawImage(p.ground(),96,96,32,32,32*e,0,32,32);break;case"BOTTOM_LEFT":this.canvasContext.ctx.drawImage(p.ground(),96,32,32,32,0,32*t,32,32);break;case"UP":this.canvasContext.ctx.drawImage(p.ground(),32,96,32,32,32*e,0,32,32);break;case"BOTTOM_RIGHT":this.canvasContext.ctx.drawImage(p.ground(),96,0,32,32,32*e,32*t,32,32);break;case"BOTTOM":this.canvasContext.ctx.drawImage(p.ground(),32,32,32,32,32*e,32*t,32,32);break;case"LEFT":this.canvasContext.ctx.drawImage(p.ground(),64,64,32,32,32*e,32*t,32,32);break;case"RIGHT":this.canvasContext.ctx.drawImage(p.ground(),0,64,32,32,32*e,32*t,32,32)}}}class W{constructor(t){this.canvasContext=t}render(t,e){this.canvasContext.ctx.drawImage(p.ground(),32,64,32,32,32*e,32*t,32,32)}}class V{constructor(t,e,s,a){this.map=t,this.characters=s,this.walls=e,this.bonus=a,this.bombs=[],this.blasts=[],this.code="NEW_GAME",B((()=>{this.walls=R().walls,this.characters=R().characters,this.bonus=R().bonus,this.bombs=R().bombs,this.blasts=R().blasts,this.map=R().map}))}update(t){this.render(t)}render(t){const e=document.getElementById("canvas");e.width=this.map[0]&&32*this.map[0].length,e.height=32*this.map.length,t.screenWidth=e.width,t.screenHeight=e.height,t.ctx.fillStyle="black",t.ctx.fillRect(0,0,t.screenWidth,t.screenHeight),this.ground=new M(t),this.frameUpLeft=new C("UP_LEFT",t),this.frameUpRight=new C("UP_RIGHT",t),this.frameUp=new C("UP",t),this.frameBottomLeft=new C("BOTTOM_LEFT",t),this.frameBottomRight=new C("BOTTOM_RIGHT",t),this.frameBottom=new C("BOTTOM",t),this.frameLeft=new C("LEFT",t),this.frameRight=new C("RIGHT",t),this.block=new W(t);for(let t=0,e=this.map.length;t<e;t++)for(let e=0,s=this.map[t].length;e<s;e++)switch(this.map[t][e]){case 2:this.ground.render(t,e);break;case 12:this.frameUpLeft.render(t,e);break;case 14:this.frameUp.render(t,e);break;case 16:this.frameUpRight.render(t,e);break;case 8:this.frameBottomLeft.render(t,e);break;case 4:this.frameBottomRight.render(t,e);break;case 6:this.frameBottom.render(t,e);break;case 11:this.frameLeft.render(t,e);break;case 9:this.frameRight.render(t,e);break;case 10:this.block.render(t,e)}this.bonus.forEach((e=>{e.render(t)}));for(let e=0,s=this.walls.length;e<s;e++)for(let s=0,a=this.walls[e].length;s<a;s++)this.walls[e][s]&&this.walls[e][s].render(t);this.bombs.forEach((e=>{e.render(t)})),this.blasts.forEach((e=>{e.render(t)})),this.characters.forEach((e=>{e.render(t)})),this.computeVictory()}computeVictory(){const t=this.characters.filter((t=>t.status===E.ALIVE));1===t.length&&t[0].status!==E.VICTORY&&_({type:y.VICTORY,payload:{character:t[0]}})}}class U{constructor(t,e,s){this.x=t,this.y=e,this.animationState=0,this.animationDuration=6,this.destroyed=s}render(t){let e=0;this.destroyed&&(e=Math.floor(this.animationState/this.animationDuration),this.animationState++),t.ctx.drawImage(p.wall(),e*p.wall().width,0,p.wall().width,p.wall().height,32*this.x,32*this.y,32,32)}}class F{constructor(t,e,s){this.type=s,this.x=t,this.y=e,this.etatAnimation=0,this.dureeAnimation=16}render(t){let e=Math.floor(this.etatAnimation/this.dureeAnimation);e>1&&(e%=2),t.ctx.drawImage(p.bonus(),(e+2*this.type)*p.bonus().width,0,p.bonus().width,p.bonus().height,32*this.x+4,32*this.y+6,32/1.5,32/1.5),this.etatAnimation++}}class G{static initWalls(t,e){const s=[];for(let e=0,a=t[0].length;e<a;e++){s[e]=[];for(let a=0,i=t.length;a<i;a++)2===t[a][e]&&this.getRandomInt(11)>1&&(s[e][a]=new U(e,a))}return e.forEach((t=>{s[t.x]&&s[t.x][t.y]&&(s[t.x][t.y]=null),s[t.x-1]&&s[t.x-1][t.y]&&(s[t.x-1][t.y]=null),s[t.x]&&s[t.x][t.y-1]&&(s[t.x][t.y-1]=null),s[t.x+1]&&s[t.x+1][t.y]&&(s[t.x+1][t.y]=null),s[t.x]&&s[t.x][t.y+1]&&(s[t.x][t.y+1]=null)})),s}static initBonus(t,e){const s=[],a=[];e.map((t=>({x:t.x,y:t.y}))).forEach((t=>{a.push(t.x.toString()+t.y.toString()),a.push((t.x-1).toString()+t.y.toString()),a.push(t.x.toString()+(t.y-1).toString()),a.push((t.x+1).toString()+t.y.toString()),a.push(t.x.toString()+(t.y+1).toString())}));for(let e=0,i=t[0].length;e<i;e++)for(let i=0,r=t.length;i<r;i++)if(2===t[i][e]){const t=this.getRandomInt(20);if(a.includes(e.toString()+i.toString()))continue;switch(t){case 1:s.push(new F(e,i,D.BOMB));break;case 10:s.push(new F(e,i,D.POWER))}}return s}static getRandomInt(t){return Math.floor(Math.random()*Math.floor(t))}}const H=document.getElementById("canvas");H.width=960,H.height=640;const Y={screenWidth:960,screenHeight:640,ctx:H.getContext("2d")};(new class{constructor(){this.keys={up:38,down:40,left:37,right:39,space:32,enter:13,escape:27},this.handledKeys=[],this.handledKeys[this.keys.up]=!1,this.handledKeys[this.keys.down]=!1,this.handledKeys[this.keys.left]=!1,this.handledKeys[this.keys.right]=!1,this.handledKeys[this.keys.space]=!1,this.handledKeys[this.keys.enter]=!1,this.handledKeys[this.keys.escape]=!1}bind(){const t=this;addEventListener("keyup",(e=>{delete t.handledKeys[e.keyCode]}),!1),addEventListener("keydown",(e=>{switch(t.handledKeys[e.keyCode]&&(t.handledKeys[e.keyCode]=!0),e.keyCode){case t.keys.up:_({type:y.UP});break;case t.keys.down:_({type:y.DOWN});break;case t.keys.enter:_({type:y.ENTER});break;case t.keys.escape:_({type:y.RESET});break;case t.keys.left:_({type:y.LEFT});break;case t.keys.right:_({type:y.RIGHT})}}),!1)}}).bind();const j=new class{constructor(){this.toucheds=[!1,!1,!1,!1],window.addEventListener("gamepadconnected",(t=>{_({type:y.ADD_PLAYER,payload:{index:t.gamepad.index}})}),!1),window.addEventListener("gamepaddisconnected",(()=>{}),!1)}listen(){[navigator.getGamepads()[0],navigator.getGamepads()[1],navigator.getGamepads()[2],navigator.getGamepads()[3]].filter((t=>!!t)).forEach(((t,e)=>{t.buttons[0].pressed&&!this.toucheds[e]?(this.toucheds[e]=!0,_({type:y.DROP_BOMB,payload:{color:e}})):!t.buttons[0].pressed&&this.toucheds[e]&&(this.toucheds[e]=!1),t.buttons[14].pressed&&_({type:y.MOVE,payload:{color:e,direction:b.LEFT}}),t.buttons[13].pressed&&_({type:y.MOVE,payload:{color:e,direction:b.DOWN}}),t.buttons[15].pressed&&_({type:y.MOVE,payload:{color:e,direction:b.RIGHT}}),t.buttons[12].pressed&&_({type:y.MOVE,payload:{color:e,direction:b.TOP}})}))}};let K=new k;B((()=>{if(K.code!==R().currentScreenCode)switch(R().currentScreenCode){case"TITLE":K=new k;break;case"OPTIONS":K=new v;break;case"NEW_GAME":{const t=G.initWalls(R().map,R().characters),e=G.initBonus(R().map,R().characters);_({type:y.INIT_GAME,payload:{status:x.IN_PROGRESS,walls:t,bonus:e}}),K=new V(R().map,t,R().characters,e)}}}));const X=()=>{K.update(Y),j.listen(),requestAnimationFrame(X)};requestAnimationFrame(X);const z={width:0,height:0,computedWidth:()=>z.width,computedHeight:()=>z.height},$=()=>{z.width=document.body.offsetWidth,z.height=document.body.offsetHeight,H.style.width=`${z.computedWidth()}px`,H.style.height=`${z.computedHeight()}px`};$(),window.addEventListener("resize",$,!1)})();
//# sourceMappingURL=main.js.map