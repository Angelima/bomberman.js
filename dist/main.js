!function(t){var e={};function s(a){if(e[a])return e[a].exports;var i=e[a]={i:a,l:!1,exports:{}};return t[a].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.m=t,s.c=e,s.d=function(t,e,a){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)s.d(a,i,function(e){return t[e]}.bind(null,i));return a},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=9)}([function(t,e,s){t.exports=s.p+"assets/images/title_bombers.png"},function(t,e,s){t.exports=s.p+"assets/images/chemin.png"},function(t,e,s){t.exports=s.p+"assets/images/arena_wall.png"},function(t,e,s){t.exports=s.p+"assets/images/arena_bomber_walk.png"},function(t,e,s){t.exports=s.p+"assets/images/arena_bomber_death.png"},function(t,e,s){t.exports=s.p+"assets/images/arena_bomb.png"},function(t,e,s){t.exports=s.p+"assets/images/arena_flame.png"},function(t,e,s){t.exports=s.p+"assets/images/arena_item.png"},function(t,e,s){t.exports=s.p+"assets/images/winner_bomber.png"},function(t,e,s){"use strict";s.r(e);var a=s(0),i=s.n(a),r=s(1),n=s.n(r),o=s(2),c=s.n(o),h=s(3),l=s.n(h),d=s(4),m=s.n(d),u=s(5),p=s.n(u),y=s(6),E=s.n(y),g=s(7),f=s.n(g),S=s(8),x=s.n(S);class O{static titleWallpaper(){return this.titleImage?this.titleImage:(this.titleImage=new Image,this.titleImage.src=i.a,this.titleImage)}static ground(){return this.groundImage?this.groundImage:(this.groundImage=new Image,this.groundImage.src=n.a,this.groundImage)}static wall(){return this.wallImage?this.wallImage:(this.wallImage=new Image,this.wallImage.src=c.a,this.wallImage.width=32,this.wallImage.height=32,this.wallImage)}static characterAlive(){return this.characterAliveImage?this.characterAliveImage:(this.characterAliveImage=new Image,this.characterAliveImage.src=l.a,this.characterAliveImage.width=43,this.characterAliveImage.height=45,this.characterAliveImage)}static characterDead(){return this.characterDeadImage?this.characterDeadImage:(this.characterDeadImage=new Image,this.characterDeadImage.src=m.a,this.characterDeadImage.width=517/12,this.characterDeadImage.height=316/7,this.characterDeadImage)}static bomb(){return this.bombImage?this.bombImage:(this.bombImage=new Image,this.bombImage.src=p.a,this.bombImage.width=100/3,this.bombImage.height=34,this.bombImage)}static flame(){return this.flameImage?this.flameImage:(this.flameImage=new Image,this.flameImage.src=E.a,this.flameImage.width=925/28,this.flameImage.height=34,this.flameImage)}static bonus(){return this.itemImage?this.itemImage:(this.itemImage=new Image,this.itemImage.src=f.a,this.itemImage.width=529/16,this.itemImage.height=34,this.itemImage)}static characterVictory(){return this.imageVictory?this.imageVictory:(this.imageVictory=new Image,this.imageVictory.width=25.25,this.imageVictory.height=33.2,this.imageVictory.src=x.a,this.imageVictory)}}const b={UP:"UP",DOWN:"DOWN",LEFT:"LEFT",RIGHT:"RIGHT",ENTER:"ENTER",MENU_OVERFLOW:"MENU_OVERFLOW",INIT:"INIT",ESCAPE:"ESCAPE",RESET:"RESET",ADD_BLAST:"ADD_BLAST",BLAST_VANISHED:"BLAST_VANISHED",DROP_BOMB:"DROP_BOMB",BOMB_EXPLODED:"BOMB_EXPLODED",DESTROY:"DESTROY",KILL:"KILL",VICTORY:"VICTORY",CONNECT:"CONNECT",INIT_CHARACTERS:"INIT_CHARACTERS",PLAYER_CHOSEN:"PLAYER_CHOSEN",CHANGE_GAME_STATUS:"CHANGE_GAME_STATUS",MOVE:"MOVE",ADD_BOMB:"ADD_BOMB",CONSUME_BONUS:"CONSUME_BONUS",GET_BONUS:"GET_BONUS"};Object.freeze(b);const w={DEFAULT:"DEFAULT",INITIALISATION:"INITIALISATION",READY:"READY",IN_PROGRESS:"IN_PROGRESS"};class T{constructor(){this.imageTitlePosition=800,this.fontSize=30,this.selectedOption=1}update(t){this.render(t)}render(t){t.ctx.fillStyle="rgb(52,173,98)",t.ctx.fillRect(0,400,t.screenWidth,t.screenHeight),t.ctx.fillStyle="lightblue",t.ctx.fillRect(0,0,t.screenWidth,400),this.imageTitlePosition>170&&(this.imageTitlePosition-=15),t.ctx.drawImage(O.titleWallpaper(),0,this.imageTitlePosition+5,t.screenWidth,t.screenHeight-160),this.fontSize<90&&this.fontSize++,t.ctx.font=this.fontSize+"px Bomberman",t.ctx.textAlign="center",t.ctx.textBaseline="top",t.ctx.fillStyle="gray",t.ctx.fillText("Bomberman.js",t.screenWidth/2+5,85),t.ctx.fillStyle="rgb(250, 250, 250)",t.ctx.fillText("Bomberman.js",t.screenWidth/2,80),t.ctx.font="20px Bomberman",t.ctx.fillStyle="rgb(250, 250, 250)",t.ctx.textAlign="center",t.ctx.textBaseline="center",t.ctx.fillText("Credit : Freuhlon",t.screenWidth/2,this.imageTitlePosition+440)}manageOverflowMenu(t,e,s){this.selectedOption=s,s>e&&(this.selectedOption=e,document.dispatchEvent(new CustomEvent("action",{detail:{type:b.MENU_OVERFLOW,payload:{selectedOption:this.selectedOption}}}))),s<t&&(this.selectedOption=t,document.dispatchEvent(new CustomEvent("action",{detail:{type:b.MENU_OVERFLOW,payload:{selectedOption:this.selectedOption}}})))}static getNewScreen(t,e,s){if("TITLE"===e){if(1===t)return"LOBBY";if(2===t)return"SCORES";if(3===t)return"OPTIONS"}return"OPTIONS"===e?"TITLE":"SCORES"===e?"TITLE":"LOBBY"===e&&s===w.READY?"NEW_GAME":void 0}}class I extends T{constructor(){super(),this.code="TITLE",document.addEventListener("state",t=>{this.manageOverflowMenu(1,3,t.detail.selectedOption)})}render(t){super.render(t),t.ctx.font="60px Bomberman",t.ctx.fillStyle=this.getColorMenu("New Game"),t.ctx.fillText("New Game",t.screenWidth/2,320),t.ctx.fillStyle=this.getColorMenu("Scores"),t.ctx.fillText("Scores",t.screenWidth/2,390),t.ctx.fillStyle=this.getColorMenu("Options"),t.ctx.fillText("Options",t.screenWidth/2,460)}getColorMenu(t){return"New Game"===t&&1===this.selectedOption||"Scores"===t&&2===this.selectedOption||"Options"===t&&3===this.selectedOption?"yellow":"rgb(250, 250, 250)"}getColorMenu(t){return"New Game"===t&&1===this.selectedOption||"Scores"===t&&2===this.selectedOption||"Options"===t&&3===this.selectedOption?"yellow":"rgb(250, 250, 250)"}}const C={DOWN:1,LEFT:7,RIGHT:4,TOP:10};Object.freeze(C);class D{constructor(t){this.character=t,this.x=t.x,this.y=t.y,this.animationState=0,this.animationDuration=16,this.timeElapsed=0,this.time=0,this.accelerator=30,this.timer=128}render(t){this.time++;let e=0;if((e=Math.floor(this.animationState/this.animationDuration))>2&&(e%=3),this.animationState++,this.timeElapsed++>this.accelerator){if(this.animationDuration<4){const t=this,e=this.character;document.dispatchEvent(new CustomEvent("action",{detail:{type:b.ADD_BLAST,payload:{bomb:t,character:e}}})),document.dispatchEvent(new CustomEvent("action",{detail:{type:b.BOMB_EXPLODED,payload:{bomb:t}}}))}this.animationDuration=this.animationDuration/2,this.timeElapsed=0}t.ctx.drawImage(O.bomb(),e*O.bomb().width,0,O.bomb().width,O.bomb().height,32*this.x+4,32*this.y+6,32/1.5,32/1.5)}}class N{constructor(t,e,s,a){this.x=t,this.y=e,this.power=s,this.cardinal=a}render(t){t.ctx.drawImage(O.flame(),O.flame().width*this.cardinal-this.power*O.flame().width,0,O.flame().width,O.flame().height,32*this.x,32*this.y,34,34)}}const v={MIDDLE:27,NORTH_MIDDLE:3,EAST_MIDDLE:7,SOUTH_MIDDLE:3,WEST_MIDDLE:7,NORTH_END:11,EAST_END:23,SOUTH_END:19,WEST_END:15};Object.freeze(v);class R{constructor(t,e,s,a,i,r){this.walls=a,this.map=s,this.x=t.x,this.y=t.y,this.animationState=0,this.time=0,this.radius=e.radius,this.timer=20,this.flames=[],this.bombs=i,this.characters=r,this.cpt=-1,this.character=e}render(t){let e,s=this.radius;if(this.animationState++,this.cpt++,this.flames.push([]),this.time++>this.timer){const t=this;document.dispatchEvent(new CustomEvent("action",{detail:{type:b.BLAST_VANISHED,payload:{blast:t}}}))}switch(this.radius){case 1:case 2:e=0;break;case 3:case 4:e=1;break;case 5:case 6:e=2}this.animationState<=this.radius&&(s=this.animationState),this.flames[this.cpt].push(new N(this.x,this.y,e,v.MIDDLE));for(let t=1,a=s;t<=a;t++)2!==this.map[this.y-t][this.x]?t=s+1:this.walls[this.x][this.y-t]?(this.flames[this.cpt].push(new N(this.x,this.y-t,e,v.NORTH_END)),this.walls[this.x][this.y-t].destroyed||document.dispatchEvent(new CustomEvent("action",{detail:{type:b.DESTROY,payload:{destroyedX:this.x,destroyedY:this.y-1}}})),t=s+1):t===a||2!==this.map[this.y-t-1][this.x]?this.flames[this.cpt].push(new N(this.x,this.y-t,e,v.NORTH_END)):this.flames[this.cpt].push(new N(this.x,this.y-t,e,v.NORTH_MIDDLE));for(let t=1,a=s;t<=a;t++)2!==this.map[this.y][this.x+t]?t=s+1:this.walls[this.x+t][this.y]?(this.flames[this.cpt].push(new N(this.x+t,this.y,e,v.EAST_END)),this.walls[this.x+t][this.y].destroyed||document.dispatchEvent(new CustomEvent("action",{detail:{type:b.DESTROY,payload:{destroyedX:this.x+t,destroyedY:this.y}}})),t=s+1):t===a||2!==this.map[this.y][this.x+t+1]?this.flames[this.cpt].push(new N(this.x+t,this.y,e,v.EAST_END)):this.flames[this.cpt].push(new N(this.x+t,this.y,e,v.EAST_MIDDLE));for(let t=1,a=s;t<=a;t++)2!==this.map[this.y+t][this.x]?t=s+1:this.walls[this.x][this.y+t]?(this.flames[this.cpt].push(new N(this.x,this.y+t,e,v.SOUTH_END)),this.walls[this.x][this.y+t].destroyed||document.dispatchEvent(new CustomEvent("action",{detail:{type:b.DESTROY,payload:{destroyedX:this.x,destroyedY:this.y+t}}})),t=s+1):t===a||2!==this.map[this.y+t+1][this.x]?this.flames[this.cpt].push(new N(this.x,this.y+t,e,v.SOUTH_END)):this.flames[this.cpt].push(new N(this.x,this.y+t,e,v.SOUTH_MIDDLE));for(let t=1,a=s;t<=a;t++)2!==this.map[this.y][this.x-t]?t=s+1:this.walls[this.x-t][this.y]?(this.flames[this.cpt].push(new N(this.x-t,this.y,e,v.WEST_END)),this.walls[this.x-t][this.y].destroyed||document.dispatchEvent(new CustomEvent("action",{detail:{type:b.DESTROY,payload:{destroyedX:this.x-t,destroyedY:this.y}}})),t=s+1):t===a||2!==this.map[this.y][this.x-t-1]?this.flames[this.cpt].push(new N(this.x-t,this.y,e,v.WEST_END)):this.flames[this.cpt].push(new N(this.x-t,this.y,e,v.WEST_MIDDLE));if(this.flames[this.cpt])for(let e=0,s=this.flames[this.cpt].length;e<s;e++){const s=this.flames[this.cpt][e],a=this.character;s.render(t),this.bombs.forEach(function(t){t.x===s.x&&t.y===s.y&&(document.dispatchEvent(new CustomEvent("action",{detail:{type:b.ADD_BLAST,payload:{bomb:t,character:a}}})),document.dispatchEvent(new CustomEvent("action",{detail:{type:b.BOMB_EXPLODED,payload:{bomb:t}}})))}),this.characters.forEach(function(t){t.x===s.x&&t.y===s.y&&document.dispatchEvent(new CustomEvent("action",{detail:{type:b.KILL,payload:{character:t}}}))})}}}const A={ALIVE:"ALIVE",VICTORIOUS:"VICTORIOUS",DEAD:"DEAD"};Object.freeze(A);class _{constructor(t,e,s,a){this.x=e,this.y=s,this.direction=a,this.animationState=-1,this.color=t,this.radius=2,this.status=A.ALIVE,this.offsetX=0,this.offsetY=0,this.animationDuration=15,this.bombMax=1,this.bombUsed=0,this.pixelsToTreat=0,this.nextFrame=this.getNextFrame(a),document.addEventListener("state",t=>{this.bonus=t.detail.bonus;const e=t.detail.characters.find(e=>e.color===t.detail.currentPlayerColor);e&&(this.radius=e.radius,this.animationDuration=e.animationDuration,this.bombMax=e.bombMax)})}render(t){switch(this.status){case A.ALIVE:this.renderAlive(t);break;case A.DEAD:this.renderDead(t);break;case A.VICTORIOUS:this.renderVictory(t)}}renderAlive(t){let e=1;this.animationState>=this.animationDuration?this.animationState=-1:this.animationState>=0&&((e=Math.floor(this.animationState/8))>3&&(e%=4),this.pixelsToTreat=32-this.animationState/this.animationDuration*32,this.pixelsToTreat<16&&(this.x=this.nextFrame.x,this.y=this.nextFrame.y),this.direction===C.TOP?this.offsetY=this.pixelsToTreat:this.direction===C.DOWN?this.offsetY=-this.pixelsToTreat:this.direction===C.LEFT?this.offsetX=this.pixelsToTreat:this.direction===C.RIGHT&&(this.offsetX=-this.pixelsToTreat),this.animationState++);let s,a;-1!==this.animationState?(s=32*this.nextFrame.x+this.offsetX,a=32*this.nextFrame.y-8+this.offsetY):(s=32*this.x+this.offsetX,a=32*this.y-8+this.offsetY),t.ctx.drawImage(O.characterAlive(),O.characterAlive().width*((()=>{switch(e){case 0:return 1;case 1:return 0;case 2:return-1;case 3:return 0}})()+this.direction),O.characterAlive().height*this.color,O.characterAlive().width,O.characterAlive().height,s,a,32,32)}getNextFrame(t){let e={x:this.x,y:this.y};switch(t){case C.DOWN:e.y++;break;case C.LEFT:e.x--;break;case C.RIGHT:e.x++;break;case C.TOP:e.y--}return e}move(t,e){if(!(this.animationState>=0)&&t&&(this.direction=t,this.nextFrame=this.getNextFrame(t),!(this.nextFrame.x<0||this.nextFrame.y<0||this.nextFrame.x>=e.map[0].length||this.nextFrame.y>=e.map.length)&&2===e.map[this.nextFrame.y][this.nextFrame.x]&&(!e.walls[this.nextFrame.x][this.nextFrame.y]||e.walls[this.nextFrame.x][this.nextFrame.y].destroyed))){this.bonus.forEach(t=>{t.x===this.nextFrame.x&&t.y===this.nextFrame.y&&document.dispatchEvent(new CustomEvent("action",{detail:{type:b.GET_BONUS,payload:{bonus:t}}}))});for(let t in e.bombs)if(e.bombs[t].x===this.nextFrame.x&&e.bombs[t].y===this.nextFrame.y)return;this.animationState=1}}renderDead(t){this.status===A.ALIVE&&(this.status=A.DEAD,this.animationState=0),t.ctx.drawImage(O.characterDead(),O.characterDead().width*Math.floor(this.animationState/10),O.characterDead().height*this.color,O.characterDead().width,O.characterDead().height,32*this.x,32*this.y,32,32),this.animationState++}renderVictory(t){let e=1;e=Math.floor(this.animationState/this.animationDuration)%2==0?0:1,t.ctx.drawImage(O.characterVictory(),O.characterVictory().width*e,O.characterVictory().height*this.color,O.characterVictory().width,O.characterVictory().height,32*this.x,32*this.y,32,32),this.animationState++}}class P{constructor(t,e,s){this.type=s,this.x=t,this.y=e,this.etatAnimation=0,this.dureeAnimation=16}render(t){let e=Math.floor(this.etatAnimation/this.dureeAnimation);e>1&&(e%=2),t.ctx.drawImage(O.bonus(),(e+2*this.type)*O.bonus().width,0,O.bonus().width,O.bonus().height,32*this.x+4,32*this.y+6,32/1.5,32/1.5),this.etatAnimation++}}class L{constructor(){}mapToFront(t){return new P(t.x,t.y,t.type)}}class B{constructor(t,e,s){this.x=t,this.y=e,this.animationState=0,this.animationDuration=6,this.destroyed=s}render(t){let e=0;this.destroyed&&(e=Math.floor(this.animationState/this.animationDuration),this.animationState++),t.ctx.drawImage(O.wall(),e*O.wall().width,0,O.wall().width,O.wall().height,32*this.x,32*this.y,32,32)}}class M{constructor(){}mapToFront(t){const e=[];for(let s=0;s<t.length;s++){e[s]=[];for(let a=0;a<t[s].length;a++)t[s][a]?e[s][a]=new B(t[s][a].x,t[s][a].y,t[s][a].destroyed):e[s][a]=null}return e}}class k{constructor(){this.connection=new WebSocket("ws://localhost:8080"),this.playerHasChoosen=!1,this.gameStatus=w.INITIALISATION,this.bonusMapper=new L,this.wallMapper=new M,document.addEventListener("state",t=>{this.playerHasChoosen=!!t.detail.currentPlayerColor,this.gameStatus=t.detail.gameStatus,this.currentScreenCode=t.detail.currentScreenCode,this.characters=t.detail.characters}),this.connection.onerror=t=>{console.log(`WebSocket error: ${t}`)},this.connection.addEventListener("message",t=>{const e=JSON.parse(t.data);switch(e.type){case"CONSUME_BONUS":document.dispatchEvent(new CustomEvent("action",{detail:{type:b.CONSUME_BONUS,payload:{bonus:e.bonus}}}));break;case"CHARACTERS_LIST":if(this.gameStatus!==w.IN_PROGRESS){const t=[];e.characters.forEach(e=>{t.push(new _(e.color,e.x,e.y,C.DOWN))}),document.dispatchEvent(new CustomEvent("action",{detail:{type:b.INIT_CHARACTERS,payload:{characters:t}}}))}e.characters.length>1&&this.ready();break;case"PLAYER_CHOSEN":this.playerHasChoosen||this.gameStatus===w.IN_PROGRESS||"LOBBY"!==this.currentScreenCode||document.dispatchEvent(new CustomEvent("action",{detail:{type:b.PLAYER_CHOSEN,payload:{currentPlayerColor:e.currentPlayerColor}}}));break;case"CHANGE_GAME_STATUS":this.gameStatus!==w.IN_PROGRESS&&e.status===w.IN_PROGRESS&&(this.init(),document.dispatchEvent(new CustomEvent("action",{detail:{type:b.CHANGE_GAME_STATUS,payload:{status:w.IN_PROGRESS,currentScreenCode:"NEW_GAME"}}}))),this.gameStatus!==w.READY&&e.status===w.READY&&(this.init(),document.dispatchEvent(new CustomEvent("action",{detail:{type:b.CHANGE_GAME_STATUS,payload:{status:w.READY,currentScreenCode:"LOBBY"}}})));break;case"INIT":document.dispatchEvent(new CustomEvent("action",{detail:{type:b.INIT,payload:{map:e.map,walls:this.wallMapper.mapToFront(e.walls),bonus:e.bonus.map(t=>this.bonusMapper.mapToFront(t))}}}));break;case"MOVE":document.dispatchEvent(new CustomEvent("action",{detail:{type:b.MOVE,payload:{currentPlayerColor:e.currentPlayerColor,direction:e.direction}}}));break;case"DROP_BOMB":document.dispatchEvent(new CustomEvent("action",{detail:{type:b.ADD_BOMB,payload:{currentPlayerColor:e.currentPlayerColor}}}));break;case"NO_CHARACTERS":console.log("Plus de place");break;default:console.log("Action server inconnue")}})}launch(){this.connection.send(JSON.stringify({type:"LAUNCH"}))}init(){this.connection.send(JSON.stringify({type:"INIT"}))}move(t,e){this.connection.send(JSON.stringify({type:"MOVE",direction:e,currentPlayerColor:t}))}dropBomb(t){this.connection.send(JSON.stringify({type:"DROP_BOMB",currentPlayerColor:t}))}victory(t){this.connection.send(JSON.stringify({type:"VICTORY",currentPlayerColor:t}))}leave(t){this.connection.send(JSON.stringify({type:"LEAVE",currentPlayerColor:t}))}ready(){this.connection.send(JSON.stringify({type:"READY"}))}consumeBonus(t,e){this.connection.send(JSON.stringify({type:"BONUS",bonus:t,currentPlayerColor:e}))}}const U={BOMB:0,POWER:1,SPEED:3};Object.freeze(U);class H extends T{constructor(){super(),this.code="OPTIONS",document.addEventListener("state",t=>{this.manageOverflowMenu(1,4,t.detail.selectedOption)})}render(t){super.render(t),t.ctx.font="50px Bomberman",t.ctx.fillStyle=this.getColorMenu("Sound"),t.ctx.fillText(" Sound : yes",t.screenWidth/2,250),t.ctx.fillStyle=this.getColorMenu("Nickname"),t.ctx.fillText(" Nickname : Freuhlon",t.screenWidth/2,320),t.ctx.fillStyle=this.getColorMenu("Color"),t.ctx.fillText(" Color : red",t.screenWidth/2,390),t.ctx.fillStyle=this.getColorMenu("Retour"),t.ctx.fillText("Retour",t.screenWidth/2,540)}getColorMenu(t){return"Sound"===t&&1===this.selectedOption||"Nickname"===t&&2===this.selectedOption||"Color"===t&&3===this.selectedOption||"Retour"===t&&4===this.selectedOption?"yellow":"rgb(250, 250, 250)"}}class F extends T{constructor(){super(),this.code="SCORES"}render(t){super.render(t),t.ctx.font="60px Bomberman",t.ctx.fillStyle="yellow",t.ctx.fillText("Retour",t.screenWidth/2,540)}}class G{constructor(t){this.canvasContext=t}render(t,e){this.canvasContext.ctx.drawImage(O.ground(),0,0,32,32,32*e,32*t,32,32)}}class W{constructor(t,e){this.type=t,this.canvasContext=e}render(t,e){switch(this.type){case"UP_LEFT":this.canvasContext.ctx.drawImage(O.ground(),96,64,32,32,32*e,32*t,32,32);break;case"UP_RIGHT":this.canvasContext.ctx.drawImage(O.ground(),96,96,32,32,32*e,0,32,32);break;case"BOTTOM_LEFT":this.canvasContext.ctx.drawImage(O.ground(),96,32,32,32,0,32*t,32,32);break;case"UP":this.canvasContext.ctx.drawImage(O.ground(),32,96,32,32,32*e,0,32,32);break;case"BOTTOM_RIGHT":this.canvasContext.ctx.drawImage(O.ground(),96,0,32,32,32*e,32*t,32,32);break;case"BOTTOM":this.canvasContext.ctx.drawImage(O.ground(),32,32,32,32,32*e,32*t,32,32);break;case"LEFT":this.canvasContext.ctx.drawImage(O.ground(),64,64,32,32,32*e,32*t,32,32);break;case"RIGHT":this.canvasContext.ctx.drawImage(O.ground(),0,64,32,32,32*e,32*t,32,32)}}}class V{constructor(t){this.canvasContext=t}render(t,e){this.canvasContext.ctx.drawImage(O.ground(),32,64,32,32,32*e,32*t,32,32)}}class Y{constructor(){this.map=[],this.characters=[],this.walls=[],this.bonus=[],this.bombs=[],this.blasts=[],this.code="NEW_GAME",document.addEventListener("state",t=>{this.walls=t.detail.walls,this.characters=t.detail.characters,this.bonus=t.detail.bonus,this.bombs=t.detail.bombs,this.blasts=t.detail.blasts,this.map=t.detail.map})}update(t){this.render(t)}render(t){const e=document.getElementById("canvas");e.width=this.map[0]&&32*this.map[0].length,e.height=32*this.map.length,t.screenWidth=e.width,t.screenHeight=e.height,t.ctx.fillStyle="black",t.ctx.fillRect(0,0,t.screenWidth,t.screenHeight),this.ground=new G(t),this.frameUpLeft=new W("UP_LEFT",t),this.frameUpRight=new W("UP_RIGHT",t),this.frameUp=new W("UP",t),this.frameBottomLeft=new W("BOTTOM_LEFT",t),this.frameBottomRight=new W("BOTTOM_RIGHT",t),this.frameBottom=new W("BOTTOM",t),this.frameLeft=new W("LEFT",t),this.frameRight=new W("RIGHT",t),this.block=new V(t);for(let t=0,e=this.map.length;t<e;t++)for(let e=0,s=this.map[t].length;e<s;e++)switch(this.map[t][e]){case 2:this.ground.render(t,e);break;case 12:this.frameUpLeft.render(t,e);break;case 14:this.frameUp.render(t,e);break;case 16:this.frameUpRight.render(t,e);break;case 8:this.frameBottomLeft.render(t,e);break;case 4:this.frameBottomRight.render(t,e);break;case 6:this.frameBottom.render(t,e);break;case 11:this.frameLeft.render(t,e);break;case 9:this.frameRight.render(t,e);break;case 10:this.block.render(t,e)}this.bonus.forEach(e=>{e.render(t)});for(let e=0,s=this.walls.length;e<s;e++)for(let s=0,a=this.walls[e].length;s<a;s++)this.walls[e][s]&&this.walls[e][s].render(t);this.bombs.forEach(e=>{e.render(t)}),this.blasts.forEach(e=>{e.render(t)}),this.characters.forEach(e=>{e.render(t)}),this.computeVictory(this.characters)}computeVictory(t){const e=this.characters.filter(t=>t.status===A.ALIVE);1===e.length&&e[0].status!==A.VICTORIOUS&&document.dispatchEvent(new CustomEvent("action",{detail:{type:b.VICTORY,payload:{character:e[0]}}}))}}class K extends T{constructor(){super(),this.code="LOBBY",this.gameStatus=null,this.characters=[],document.addEventListener("state",t=>{this.gameStatus=t.detail.gameStatus,this.characters=t.detail.characters})}render(t){super.render(t),t.ctx.font="35px Bomberman";let e=0;for(let s=0;s<4;s++){const a=this.characters[s]?`Player ${s+1} : Ready`:". . .";t.ctx.fillText(a,t.screenWidth/2,300+e),e+=40}t.ctx.fillStyle=this.gameStatus===w.READY?"yellow":"rgb(250, 250, 250)",t.ctx.fillText(this.gameStatus===w.READY?"Go !":"Wait ...",t.screenWidth/2,540)}}const X=document.getElementById("canvas");X.width=960,X.height=640;const j={screenWidth:960,screenHeight:640,ctx:X.getContext("2d")};(new class{constructor(){this.initialState(),this.connection=null}initialState(){this.state={gameStatus:"INITIALISATION",selectedOption:1,currentScreenCode:"TITLE",map:[],currentPlayerColor:0,characters:[],bonus:[],bombs:[],walls:[],blasts:[]}}createStore(){const t=this;document.addEventListener("action",function(e){t.state=t.reducer(t.state,e.detail),document.dispatchEvent(new CustomEvent("state",{detail:t.state}))},!1)}reducer(t,e){if(!t)return this.initialState();switch(e.type){case b.UP:return this.connection&&t.gameStatus===w.IN_PROGRESS&&(t.characters.find(e=>e.color===t.currentPlayerColor).move(C.TOP,t),this.connection.move(t.currentPlayerColor,C.TOP)),{...t,selectedOption:t.selectedOption-1};case b.DOWN:return this.connection&&t.gameStatus===w.IN_PROGRESS&&(t.characters.find(e=>e.color===t.currentPlayerColor).move(C.DOWN,t),this.connection.move(t.currentPlayerColor,C.DOWN)),{...t,selectedOption:t.selectedOption+1};case b.LEFT:return this.connection&&t.gameStatus===w.IN_PROGRESS&&(t.characters.find(e=>e.color===t.currentPlayerColor).move(C.LEFT,t),this.connection.move(t.currentPlayerColor,C.LEFT)),t;case b.RIGHT:return this.connection&&t.gameStatus===w.IN_PROGRESS&&(t.characters.find(e=>e.color===t.currentPlayerColor).move(C.RIGHT,t),this.connection.move(t.currentPlayerColor,C.RIGHT)),t;case b.ENTER:let s=T.getNewScreen(t.selectedOption,t.currentScreenCode,t.gameStatus);return this.connection&&t.gameStatus!==w.IN_PROGRESS&&this.connection.launch(),{...t,selectedOption:1,currentScreenCode:s};case b.MENU_OVERFLOW:return{...t,selectedOption:e.payload.selectedOption};case b.INIT:return{...t,map:e.payload.map,walls:e.payload.walls,bonus:e.payload.bonus};case b.INIT_CHARACTERS:return t.characters=e.payload.characters,{...t};case b.PLAYER_CHOSEN:return{...t,currentPlayerColor:e.payload.currentPlayerColor};case b.CONNECT:return this.connection=new k,{...t,selectedOption:1};case b.RESET:return setTimeout(function(){location.reload()},100),this.connection&&this.connection.leave(),this.state;case b.ADD_BLAST:return t.blasts.push(new R(e.payload.bomb,e.payload.character,t.map,t.walls,t.bombs,t.characters)),{...t};case b.BLAST_VANISHED:return t.blasts.splice(t.blasts.indexOf(e.payload.blast),1),{...t};case b.DROP_BOMB:return t.characters.find(t=>t.color===e.payload.currentPlayerColor).bombUsed<=t.characters.find(t=>t.color===e.payload.currentPlayerColor).bombMax&&(this.connection&&t.gameStatus===w.IN_PROGRESS&&this.connection.dropBomb(t.currentPlayerColor),t.characters.find(t=>t.color===e.payload.currentPlayerColor).bombUsed++,t.bombs.push(new D(t.characters.find(t=>t.color===e.payload.currentPlayerColor)))),{...t};case b.BOMB_EXPLODED:return t.characters.find(e=>e.color===t.currentPlayerColor).bombUsed--,t.bombs.splice(t.bombs.indexOf(e.payload.bomb),1),{...t};case b.DESTROY:return t.walls[e.payload.destroyedX][e.payload.destroyedY].destroyed=!0,{...t};case b.KILL:return t.characters.find(t=>t.color===e.payload.character.color).status=A.DEAD,{...t};case b.VICTORY:const a=t.characters.find(t=>t.color===e.payload.character.color);return a.status=A.VICTORIOUS,this.connection.victory(a.currentPlayerColor),{...t};case b.CHANGE_GAME_STATUS:return{...t,gameStatus:e.payload.status,currentScreenCode:e.payload.currentScreenCode};case b.MOVE:return t.characters.find(t=>t.color===e.payload.currentPlayerColor).move(e.payload.direction,t),{...t};case b.ADD_BOMB:return t.characters.find(t=>t.color===e.payload.currentPlayerColor).bombUsed++,t.bombs.push(new D(t.characters.find(t=>t.color===e.payload.currentPlayerColor))),{...t};case b.CONSUME_BONUS:{switch(e.payload.bonus.type){case U.POWER:t.characters.find(e=>e.color===t.currentPlayerColor).radius++;break;case U.BOMB:t.characters.find(e=>e.color===t.currentPlayerColor).bombMax++;break;case U.SPEED:const s=t.characters.find(e=>e.color===t.currentPlayerColor);t.characters.find(e=>e.color===t.currentPlayerColor)>8&&(t.characters.find(e=>e.color===t.currentPlayerColor).animationDuration=s.animationDuration-1)}const s=t.bonus.find(t=>t.x===e.payload.bonus.x&&t.y===e.payload.bonus.y);return t.bonus.splice(t.bonus.indexOf(s),1),{...t}}case b.GET_BONUS:return this.connection.consumeBonus(e.payload.bonus,t.currentPlayerColor),{...t}}}}).createStore(),(new class{constructor(){this.keys={up:38,down:40,left:37,right:39,space:32,enter:13,escape:27},this.handledKeys=[],this.handledKeys[this.keys.up]=!1,this.handledKeys[this.keys.down]=!1,this.handledKeys[this.keys.left]=!1,this.handledKeys[this.keys.right]=!1,this.handledKeys[this.keys.space]=!1,this.handledKeys[this.keys.enter]=!1,this.handledKeys[this.keys.escape]=!1,document.addEventListener("state",t=>{this.currentPlayerColor=t.detail.currentPlayerColor})}bind(){const t=this;addEventListener("keyup",function(e){delete t.handledKeys[e.keyCode]},!1),addEventListener("keydown",function(e){switch(t.handledKeys[e.keyCode]&&(t.handledKeys[e.keyCode]=!0),e.keyCode){case t.keys.up:document.dispatchEvent(new CustomEvent("action",{detail:{type:b.UP}}));break;case t.keys.down:document.dispatchEvent(new CustomEvent("action",{detail:{type:b.DOWN}}));break;case t.keys.enter:document.dispatchEvent(new CustomEvent("action",{detail:{type:b.ENTER}}));break;case t.keys.escape:document.dispatchEvent(new CustomEvent("action",{detail:{type:b.RESET}}));break;case t.keys.left:document.dispatchEvent(new CustomEvent("action",{detail:{type:b.LEFT}}));break;case t.keys.right:document.dispatchEvent(new CustomEvent("action",{detail:{type:b.RIGHT}}));break;case t.keys.space:document.dispatchEvent(new CustomEvent("action",{detail:{type:b.DROP_BOMB,payload:{currentPlayerColor:t.currentPlayerColor}}}))}},!1)}}).bind();let z=new I;document.addEventListener("state",t=>{if(z.code!==t.detail.currentScreenCode)switch(t.detail.currentScreenCode){case"TITLE":z=new I;break;case"OPTIONS":z=new H;break;case"SCORES":z=new F;break;case"LOBBY":z=new K,document.dispatchEvent(new CustomEvent("action",{detail:{type:b.CONNECT}}));break;case"NEW_GAME":z=new Y}});const J=()=>{z.update(j),requestAnimationFrame(J)};requestAnimationFrame(J);const q={width:0,height:0,computedWidth:function(){return q.width},computedHeight:function(){return q.height}},$=()=>{q.width=document.body.offsetWidth,q.height=document.body.offsetHeight,X.style.width=q.computedWidth()+"px",X.style.height=q.computedHeight()+"px"};$(),window.addEventListener("resize",$,!1)}]);
//# sourceMappingURL=main.js.map